<!doctype html>
<html lang="en">
  <head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
	<link rel="stylesheet" href="css/ol.css" type="text/css">
	<link rel="stylesheet" href="css/unav.css" type="text/css">
	<style>
	  .map {
		height: 400px;
		width: 100%;
	  }
	</style>
	<script src="js/jquery.min.js" type="text/javascript"></script>
	<script src="js/ol.js" type="text/javascript"></script>
	<title>uNav for Ubuntu Phone</title>
  </head>
  <body>
	<div id="map" class="map"></div>
	<script type="text/javascript">
	  var map = new ol.Map({
		target: 'map',
		layers: [
		  new ol.layer.Tile({
			source: new ol.source.MapQuest({layer: 'osm'})
		  })
		],
		view: new ol.View({
		center: ol.proj.transform([4.666389, 50.009167], 'EPSG:4326', 'EPSG:3857'),
		zoom: 15,
		minZoom: 1,
		maxZoom: 22
		})
	  });
		pos = new ol.Overlay({
		element: $('<img id="marker_pos" src="img/pos.png">')
			.css({marginTop: '-40px', marginLeft: '-12px', cursor: 'pointer'})
		});
		map.addOverlay(pos);
	</script>
	<div id="unav">
		
		<table class="tg">
		  <tr>
			<th class="tg-yw4l">
				<a href="https://uappexplorer.com/app/navigator.costales"><img src="img/unav.png" id="unav_logo"></a> for <a href="http://www.ubuntu.com/phone/devices"><img id="ubuntu_logo" src="img/ubuntu.svg"></a>
			</th>
		  </tr>
		  <tr>
			<td class="tg-yw4l">
				<span class="coord" id="lat">Lat: ?</span>&nbsp;<span class="coord" id="lon">Lon: ?</span>
			</td>
		  </tr>
		</table>
	</div>
	<div id="map_attribution"><span id="attrib_text">© <a href="https://mapzen.com/projects/valhalla">Mapzen</a> © <a href="http://open.mapquest.com/">MapQuest</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a></span></div>

	<script>
		function getURLParameter(name) {
		  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
		}
		var coord = getURLParameter('p');
		var lat = parseFloat(coord.split(',')[0]);
		var lon = parseFloat(coord.split(',')[1]);
		if (lat !== null && lon !== null) {
			$('#lat').html("Lat: " + lat.toFixed(4));
			$('#lon').html("Lon: " + lon.toFixed(4));
			pos.setPosition(ol.proj.transform([lon, lat], 'EPSG:4326', 'EPSG:3857'));
			map.getView().setCenter(ol.proj.transform([lon, lat], 'EPSG:4326', 'EPSG:3857'));
		}
		else {
			map.getView().setZoom(4);
		}
	</script>
  </body>
</html>
